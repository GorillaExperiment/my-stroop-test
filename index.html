<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤çŸ¥èƒ½åŠ›è¯„ä¼°ç³»ç»Ÿ - Stroop Test</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); width: 90%; max-width: 500px; padding: 2rem; border-radius: 1.5rem; shadow: 0 10px 25px rgba(0,0,0,0.05); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); text-align: center; }
        
        /* è¡¨å•ä¸æŒ‰é’®æ ·å¼ */
        .input-group { text-align: left; margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; }
        input, select { width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; padding: 0.8rem 2rem; border-radius: 0.6rem; font-weight: 600; cursor: pointer; transition: all 0.2s; width: 100%; font-size: 1rem; }
        button:hover { background: #1d4ed8; transform: translateY(-1px); }
        
        /* æ¸¸æˆåŒºåŸŸ */
        #word { font-size: 4rem; font-weight: 800; margin: 2rem 0; min-height: 5rem; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .color-btn { color: white; padding: 1.2rem; border-radius: 0.8rem; font-size: 1.1rem; }
        
        /* æ ‡ç­¾ */
        .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.8rem; font-weight: bold; margin-bottom: 1rem; }
        .practice-badge { background: #fef3c7; color: #92400e; }
        .formal-badge { background: #dcfce7; color: #166534; }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="step-info">
        <h2 style="margin-top:0">è¢«è¯•åŸºæœ¬ä¿¡æ¯ç™»è®°</h2>
        <div class="input-group">
            <label>æ€§åˆ«</label>
            <select id="subject-gender">
                <option value="male">ç”·</option>
                <option value="female">å¥³</option>
                <option value="other">å…¶ä»–</option>
            </select>
        </div>
        <div class="input-group">
            <label>å¹´é¾„</label>
            <input type="number" id="subject-age" placeholder="è¯·è¾“å…¥æ‚¨çš„å¹´é¾„">
        </div>
        <button onclick="toPractice()">å¼€å§‹ç»ƒä¹ </button>
    </div>

    <div id="step-test" class="hidden">
        <div id="phase-indicator"></div>
        <div id="progress" style="font-size: 0.9rem; color: #64748b;">è¿›åº¦: 0 / 0</div>
        <div id="word"></div>
        <div class="grid">
            <button class="color-btn" style="background:#ef4444" onclick="handleInput('red')">çº¢</button>
            <button class="color-btn" style="background:#3b82f6" onclick="handleInput('blue')">è“</button>
            <button class="color-btn" style="background:#22c55e" onclick="handleInput('green')">ç»¿</button>
            <button class="color-btn" style="background:#eab308" onclick="handleInput('yellow')">é»„</button>
        </div>
    </div>

    <div id="step-finish" class="hidden">
        <h2 style="color:#166534">æµ‹è¯•å®Œæˆ</h2>
        <p>æ‚¨çš„ååº”æ•°æ®å·²å‡†å¤‡å°±ç»ªï¼Œè¯·ä¸‹è½½æ–‡ä»¶åé¦ˆç»™ç ”ç©¶å‘˜ã€‚</p>
        <button onclick="exportData()">ğŸ’¾ ä¸‹è½½æ•°æ®æŠ¥å‘Š (CSV)</button>
    </div>
</div>

<script>
    const config = { practice: 5, formal: 20 }; // ç»ƒä¹ 5æ¬¡ï¼Œæ­£å¼20æ¬¡
    const colors = ['red', 'blue', 'green', 'yellow'];
    const names = {'red':'çº¢', 'blue':'è“', 'green':'ç»¿', 'yellow':'é»„'};
    
    let state = {
        phase: 'practice', // practice æˆ– formal
        current: 0,
        results: [],
        subject: {},
        startTime: 0
    };

    function toPractice() {
        const age = document.getElementById('subject-age').value;
        if(!age) return alert("è¯·å¡«å†™å¹´é¾„");
        
        state.subject = {
            gender: document.getElementById('subject-gender').value,
            age: age
        };
        
        document.getElementById('step-info').classList.add('hidden');
        document.getElementById('step-test').classList.remove('hidden');
        startPhase('practice');
    }

    function startPhase(phase) {
        state.phase = phase;
        state.current = 0;
        const indicator = document.getElementById('phase-indicator');
        indicator.innerHTML = phase === 'practice' 
            ? '<span class="badge practice-badge">ç»ƒä¹ æ¨¡å¼ (ä¸è®¡åˆ†)</span>' 
            : '<span class="badge formal-badge">æ­£å¼æµ‹è¯• (æ•°æ®è®°å½•ä¸­)</span>';
        nextTrial();
    }

    function nextTrial() {
        const total = state.phase === 'practice' ? config.practice : config.formal;
        if(state.current >= total) {
            if(state.phase === 'practice') {
                alert("ç»ƒä¹ ç»“æŸï¼Œç‚¹å‡»ç¡®å®šå¼€å§‹æ­£å¼æµ‹è¯•ï¼");
                startPhase('formal');
            } else {
                showFinish();
            }
            return;
        }
        
        state.current++;
        document.getElementById('progress').innerText = `è¿›åº¦: ${state.current} / ${total}`;
        
        const targetWord = colors[Math.floor(Math.random()*4)];
        const targetColor = colors[Math.floor(Math.random()*4)];
        
        const el = document.getElementById('word');
        el.innerText = names[targetWord];
        el.style.color = targetColor;
        el.dataset.correct = targetColor;
        
        state.startTime = performance.now();
    }

    function handleInput(selected) {
        const rt = (performance.now() - state.startTime).toFixed(2);
        const correctColor = document.getElementById('word').dataset.correct;
        
        if(state.phase === 'formal') {
            state.results.push({
                ...state.subject,
                trial: state.current,
                is_correct: selected === correctColor ? 1 : 0,
                rt: rt,
                word: document.getElementById('word').innerText,
                color: correctColor
            });
        }
        nextTrial();
    }

    function showFinish() {
        document.getElementById('step-test').classList.add('hidden');
        document.getElementById('step-finish').classList.remove('hidden');
    }

    function exportData() {
        let csv = "\uFEFFGender,Age,Trial,Word,Color,IsCorrect,RT_ms\n";
        state.results.forEach(r => {
            csv += `${r.gender},${r.age},${r.trial},${r.word},${r.color},${r.is_correct},${r.rt}\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Stroop_Result_${Date.now()}.csv`;
        a.click();
    }
</script>
</body>
</html>
